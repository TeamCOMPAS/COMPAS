name: COMPAS compile test

on: [pull_request]

jobs:
  compas:
    name: Build COMPAS
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2

      - name: Install dependencies 
        run: sudo apt update && sudo apt install g++ libboost-all-dev libgsl-dev libhdf5-serial-dev 

      - name: Build Compas
        run: cd src && make -j $(nproc) -f Makefile
        run: ./COMPAS -v

      - name: Install Python 3.8 and required packages
        run: sudo apt-get install python3.8 python3.8-dev python3.8-distutils python3.8-venv
        run: python3 --version
        run: python3.8 -m venv dev3.8
        run: source dev3.8/bin/activate
        run: which python
        run: cd .. && pip install requirements.txt
      
      - name: Run Post-Processing Python Scripts
        run: cd utils/example_plots/methods_paper_plots/detailed_evolution
        run: python3 runSubmitDemo.py
        run: python3 plot_detailed_evolution.py
