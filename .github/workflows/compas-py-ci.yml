# Tests that py code is formatted correctly, can install, and runs tests
name: COMPAS py lint and test

on:
  push:
    paths: ['utils/**', 'py_tests/**']
  pull_request:
    paths: ['utils/**', 'py_tests/**']

jobs:
#  pre-commit: # COMMENTING OUT FOR NOW AS THERE WILL BE ALOT OF CHANGES
#    runs-on: ubuntu-latest
#    steps:
#    - uses: actions/checkout@v2
#    - uses: actions/setup-python@v2
#    - uses: pre-commit/action@v2.0.3

#  build-n-test: # COMMENTING OUT FOR NOW AS NO TESTS
#    runs-on: ubuntu-latest
#    strategy:
#      matrix:
#        python-version: [3.8]
#
#    steps:
#    - uses: actions/checkout@v2
#    - name: Set up Python ${{ matrix.python-version }}
#      uses: actions/setup-python@v2
#      with:
#        python-version: ${{ matrix.python-version }}
#    - name: Install dependencies
#      run: |
#        python -m pip install --upgrade pip
#        pip install -e .[dev]
#    - name: Test with pytest
#      run: |
#        pytest py_tests/

      # This step will run only on all runners
      - name: Install Python packages
        run: |
          python3 -m pip install -r requirements.txt

      # This step will run on all runners
      # **To be investigated further** plotting script is currently failing on macos because
      # for some reason it cannot recognise latex is installed
      - name: Run Post-Processing Python Scripts
        run: |
          cd utils/cicd-scripts
          chmod 755 python-scripts
          ./python-scripts
